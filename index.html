<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>FORMATEAR TEXTO SHOTSPOTTER</title>
<style>
html, body, * { cursor: url("./CURSOR.cur"), auto; }
body { background-color: #1A0E3D; color: #E6E6FA; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
h2 { color: #7FFF00; text-align: center; font-size: 2em; }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
#title span { display: inline-block; animation: float 2s ease-in-out infinite; }
textarea { width: 100%; background-color: #2E1A5C; color: #E6E6FA; border: 2px solid #7FFF00; padding: 10px; font-family: monospace; font-size: 14px; resize: vertical; }
button { background-color: #7FFF00; color: #1A0E3D; border: none; padding: 10px 20px; margin: 5px 5px 15px 0; font-weight: bold; cursor: pointer; transition: 0.2s; }
button:hover { background-color: #5FCC00; }
#output { background-color: #2E1A5C; color: #E6E6FA; border: 2px solid #7FFF00; width: 100%; }
#counter { font-size: 1.5em; font-weight: bold; margin: 10px 0; color: #FF8C00; text-shadow: 0 0 6px #FF8C00; }
#log { margin-top: 10px; max-height: 250px; overflow-y: auto; border: 2px solid #7FFF00; padding: 10px; background-color: #1F0F4B; font-family: monospace; }
.log-entry { padding: 5px; border-bottom: 1px solid #7FFF00; }
.timestamp { color: #AAAAAA; margin-right: 10px; }
#warning { position: fixed; top: 20px; right: 20px; background: #FF3333; color: white; padding: 12px 18px; border-radius: 6px; font-weight: bold; opacity: 0; transition: opacity .4s ease; z-index: 9999; }
#warning.show { opacity: 1; }

#roundsAnimationContainer {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 9999;
    pointer-events: none;
}

.rounds-line {
    display: flex;
    align-items: center;
    gap: 10px;
}

.rounds-text {
    font-size: 1.4em;
    font-weight: bold;
    color: #FF5555;
    text-shadow: 0 0 6px red;
}

.rounds-bullet {
    width: 32px;
    height: 32px;
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.15s ease, transform 0.15s ease;
}

/* ðŸ”¥ Zona image 20% bigger */
.rounds-special {
    width: 180px; /* was 150px */
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.5s ease, transform 0.5s ease, filter 0.3s ease;
    border: 4px solid white;
    box-shadow: 0 0 20px #fff;
    border-radius: 8px;
}

#zonaLabel {
    font-size: 1.5em;
    font-weight: bold;
    color: #7FFF00;
}
</style>
</head>

<body>

<h2 id="title">FORMATEAR TEXTO SHOTSPOTTER</h2>

<textarea id="input" rows="12" placeholder="Pegar acÃ¡ el incidente"></textarea><br>
<button onclick="convertir()">Convertir</button>
<button onclick="limpiar()">Limpiar</button>
<br><br>
<textarea id="output" rows="2" readonly></textarea>

<div id="counter">CANTIDAD DE EVENTOS CARGADOS: 0</div>
<div id="log"><strong>Historial de conversiones:</strong></div>
<div id="warning"></div>

<div id="roundsAnimationContainer"></div>

<script>
let sixthLine = "";

function animateRounds(rounds) {
    rounds = parseInt(rounds);
    if (!rounds || rounds <= 0) return;

    const TOTAL_TIME = 5000;
    const END_BUFFER = 800;

    const container = document.getElementById("roundsAnimationContainer");
    container.innerHTML = "";

    const line = document.createElement("div");
    line.className = "rounds-line";

    const zona = document.createElement("span");
    zona.id = "zonaLabel";
    zona.textContent = "Zona:";
    line.appendChild(zona);

    let bulletsDelay = 0;
    if (sixthLine === "UYMontevideoCerro") addZona("./cerro.png");
    if (sixthLine === "UYMontevideoLasAcacias") addZona("./acacias.png");
    if (sixthLine === "UYMontevideoPenarol") addZona("./penarol.png");

    function addZona(src) {
        const img = document.createElement("img");
        img.src = src;
        img.className = "rounds-special";
        line.appendChild(img);

        setTimeout(() => {
            img.style.opacity = "1";
            img.style.transform = "scale(1.2)";
            img.style.filter = "brightness(300%)";
        }, 0);

        setTimeout(() => {
            img.style.transform = "scale(1)";
            img.style.filter = "brightness(100%)";
        }, 300);

        bulletsDelay = 350;
    }

    const roundsLabel = document.createElement("span");
    roundsLabel.className = "rounds-text";
    roundsLabel.textContent = `Rondas Ã— ${rounds}`;
    roundsLabel.style.opacity = "0";
    setTimeout(() => roundsLabel.style.opacity = "1", bulletsDelay);
    line.appendChild(roundsLabel);

    const bulletTime = TOTAL_TIME - bulletsDelay - END_BUFFER;
    const bulletInterval = Math.max(bulletTime / rounds, 40);

    for (let i = 0; i < rounds; i++) {
        const b = document.createElement("img");
        b.src = "./balita.png";
        b.className = "rounds-bullet";
        line.appendChild(b);

        setTimeout(() => {
            b.style.opacity = "1";
            b.style.transform = "scale(1)";
        }, bulletsDelay + i * bulletInterval);
    }

    container.appendChild(line);

    setTimeout(() => container.innerHTML = "", TOTAL_TIME);
}

function convertir() {
    sixthLine = "UYMontevideoCerro"; // demo
    animateRounds(8);
}

function limpiar() {
    document.getElementById("input").value = "";
    document.getElementById("output").value = "";
}

const title = document.getElementById("title");
const text = title.textContent;
title.textContent = "";
[...text].forEach(ch => {
    const s = document.createElement("span");
    s.textContent = ch;
    s.style.animationDelay = Math.random() * 1.5 + "s";
    title.appendChild(s);
});
</script>

</body>
</html>
